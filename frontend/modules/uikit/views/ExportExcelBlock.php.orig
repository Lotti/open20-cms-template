<?php

<<<<<<< HEAD
use app\assets\SocialAsset;
use elitedivision\amos\core\forms\ActiveForm;
use elitedivision\amos\core\helpers\Html;
use app\modules\uikit\BaseUikitBlock;

$canSeeBlock = true;
$visibility = $this->varValue('visibility');

switch($visibility){
    case 'guest':
        $canSeeBlock = Yii::$app->user->isGuest;          
    break;
    case 'logged':
        $canSeeBlock = !Yii::$app->user->isGuest; 
		$n_class = $this->varValue('addclass');
		if($canSeeBlock && !empty($n_class)){
			$canSeeBlock = BaseUikitBlock::visivility($n_class);
		}
    break;
}
=======
use app\modules\cms\utility\StorageUtility;
use app\modules\uikit\Uikit;
use elitedivision\amos\documenti\models\Documenti;
use open20\design\assets\BootstrapItaliaDesignAsset;
use app\modules\uikit\BaseUikitBlock;
>>>>>>> origin/gara2023

$canSeeBlock = true;
$visibility = $this->varValue('visibility');

switch($visibility){
    case 'guest':
        $canSeeBlock = Yii::$app->user->isGuest;          
    break;
    case 'logged':
        $canSeeBlock = !Yii::$app->user->isGuest; 
		$n_class = $this->varValue('addclass');
		if($canSeeBlock && !empty($n_class)){
			$canSeeBlock = BaseUikitBlock::visivility($n_class);
		}
    break;
}


/**
 * @var $this
 * @var $data
 */
$bootstrapItaliaAsset = BootstrapItaliaDesignAsset::register($this);


$id    = $data['id'];
$class = $data['class'];
$attrs = $data['attrs'];

// Accordion
//$attrs['uk-accordion'] = Uikit::json(Uikit::pickBool($data, ['multiple', 'collapsible']));
?>
<?php if ($canSeeBlock): ?>
<<<<<<< HEAD

    <?php 

        $render = isset($data['for_logged']) && !empty($data['for_logged']) ? !\Yii::$app->user->isGuest : true;             
        if ($render):
            
    ?>
        <div>
            <?php
            //Uikit::trace($data);
            //Uikit::trace($debug);
            //Uikit::trace($request);
            //Uikit::trace($model->attributes());
            $form            = ActiveForm::begin([
                    'options' => ['enctype' => 'multipart/form-data', 'autocomplete' => "off",'target'=>'_blank'],
                    'encodeErrorSummary' => false,
                    'fieldConfig' => ['errorOptions' => ['encode' => false, 'class' => 'help-block']]
            ]);
            ?>


            <div class="uk-form-controls">
                <div>
                    <?= Html::hiddenInput('id', $data['id']); ?>
                </div>
                <?= Html::submitButton(!empty($data['submitlabel']) ? $data['submitlabel'] : 'Esporta i dati in un Excel',
                    ['class' => 'btn btn-primary'])
                ?>
            </div>
        </div>
<<<<<<< HEAD
    </div>
    <?php ActiveForm::end(); ?>
<?php endif; 
=======
        <?php ActiveForm::end(); ?>
    <?php endif; ?>
<?php endif; ?>
>>>>>>> origin/gianluca/gara2023
=======
    <div class="attachments-detail">
        <ul<?= Uikit::attrs(compact('id', 'class'), $attrs) ?>>
        <?php foreach ($data['items'] as $item) : ?>
            <li class="attachments-detail__item">
                <?php
                $infos = [];
                if ($item['attachment']) {                
                    $document = Documenti::findOne(['file_cms_id' => $item['attachment']]);
                }
                ?>
                <?php
                    if(is_null($document))
                    {
                        $fileSystem = new StorageUtility();
                        $infos = $fileSystem->getFileInfo($item['attachment']);
                ?>
                    <a class="d-flex" href="<?= isset($infos['url']) ?  $infos['url'] : '' ?>" title="<?= $infos['name']?>">
                        <svg class="icon icon-primary">
                            <use xlink:href=" <?=$bootstrapItaliaAsset->baseUrl ?>/node_modules/bootstrap-italia/dist/svg/sprite.svg#it-clip"></use>
                        </svg>
                        <div class="news-allegato-name"><?= $item['title']?></div>
                    </a>
                <?php
                    } else {
                        $url = Yii::$app->getModule('backendobjects')::getBaseUrl($document->id, $blockItemId, $sitemap = false, $relatedDitailPage = false, $isrest = false); 
                        $mainDoc = $document->getDocumentMainFile();
                    ?>
                    <a class="d-flex" href="<?= isset($url) ?  $url : '' ?>" title="<?= $document->titolo ?>">
                        <svg class="icon icon-primary">
                            <use xlink:href=" <?=$bootstrapItaliaAsset->baseUrl ?>/node_modules/bootstrap-italia/dist/svg/sprite.svg#it-clip"></use>
                        </svg>
                        <div class="news-allegato-name"><?= $mainDoc->name ?>
                    </div>
                        
                        
                        
                    </a>
                <?php
                    }
                ?>
            </li>
        <?php endforeach ?>
        </ul>
    </div>
<?php endif; ?>
>>>>>>> origin/gara2023
